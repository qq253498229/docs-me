<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>桶聚合 :: docs-me</title>
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">docs-me</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs-es-java" data-version="6.2.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../1Preface/readme.html">ES Java API Client</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../1Preface/readme.html">前言</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../2JavaDoc/readme.html">Javadoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../3MavenRepository/readme.html">Maven仓库</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3MavenRepository/LuceneSnapshotRepository.html">Lucene Snapshot仓库</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3MavenRepository/log4j2.html">Log4j 2 日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3MavenRepository/UsingAnotherLogger.html">使用其它的日志</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../4Client/readme.html">Client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../5DocumentAPIs/readme.html">Document接口</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../5DocumentAPIs/IndexAPI.html">Index接口</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../5DocumentAPIs/1IndexAPI/GenerateJSONDocument.html">生成JSON文档</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../5DocumentAPIs/1IndexAPI/IndexDocument.html">索引一个文档</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/GetAPI.html">Get接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/DeleteAPI.html">Delete接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/DeleteByQueryAPI.html">Delete By Query接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/UpdateAPI.html">Update接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/MultiGetAPI.html">Multi Get接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/BulkAPI.html">Bulk接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/UsingBulkProcessor.html">使用Bulk Processor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/UpdateByQueryAPI.html">通过脚本修改接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5DocumentAPIs/ReindexAPI.html">重新索引接口</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../6SearchAPI/readme.html">Search接口</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6SearchAPI/UsingScrollsInJava.html">使用游标查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6SearchAPI/MultiSearchAPI.html">批量查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6SearchAPI/UsingAggregations.html">使用聚合</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6SearchAPI/TerminateAfter.html">设置终止标志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6SearchAPI/SearchTemplate.html">模版查询</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="readme.html">聚合</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="StructuringAggregations.html">构建聚合</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MetricsAggregations.html">指标聚合</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="BucketAggregations.html">桶聚合</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../8QueryDSL/readme.html">领域查询</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/MatchAllQuery.html">匹配所有的查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/FullTextQueries.html">全文检索</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/TermLevelQueries.html">匹配查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/CompoundQueries.html">组合查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/JoiningQueries.html">关联关系查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/GeoQueries.html">地理位置查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/SpecializedQueries.html">特殊查询</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../8QueryDSL/SpanQueries.html">跨度查询</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../9JavaAPIAdministration/readme.html">管理员接口</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../9JavaAPIAdministration/IndicesAdministration.html">管理索引接口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../9JavaAPIAdministration/ClusterAdministration.html">管理集群接口</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html">《Elasticsearch: 权威指南》中文版</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../0Remark/words.html">名词解释(对比关系型数据库)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ES Java API Client</span>
    <span class="version">6.2.2</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../docs-config/0.0.1/index.html">docs-config</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-config/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-steam-electron/0.0.1/index.html">docs-steam-electron</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-steam-electron/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-xiuxian/0.0.1/index.html">docs-xiuxian</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-xiuxian/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../../7.16.0/introduction.html">ES Java API Client</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../7.16.0/introduction.html">7.16.0</a>
        </li>
        <li class="version">
          <a href="../../6.8.0/preface.html">6.8.0</a>
        </li>
        <li class="version is-current">
          <a href="../1Preface/readme.html">6.2.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-greenworks-js/0.0.1/index.html">Greenworks-JS 文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-greenworks-js/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-rust-libp2p/0.0.1/index.html">libp2p入门</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-rust-libp2p/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-neutralino-api/0.0.1/index.html">NeutralinoJS 文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-neutralino-api/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-antora-oauth2.1/0.0.1/index.html">OAuth 2.1 授权框架</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-antora-oauth2.1/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-pd2/0.0.1/index.html">PD2记录</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-pd2/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-peerjs/0.0.1/index.html">PEER JS</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-peerjs/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-actuator/3.3.3/index.html">Spring Boot Actuator</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-actuator/3.3.3/index.html">3.3.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-oauth2/0.0.1/index.html">Spring Boot OAuth2</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-oauth2/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-steamworks-rs/0.11.0/index.html">Steamworks for Rust</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-steamworks-rs/0.11.0/index.html">0.11.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-tauri/v1/index.html">Tauri API 文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-tauri/v1/index.html">v1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-testing-angular/中文/start.html">Testing Angular</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-testing-angular/中文/start.html">中文</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-me/0.0.1/index.html">个人记录</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-me/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-taiwu/0.0.1/index.html">太吾绘卷</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-taiwu/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-palworld/0.0.1/index.html">幻兽帕鲁笔记</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-palworld/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-building-event-driven-microservices/0.0.1/index.html">微服务与事件驱动架构</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-building-event-driven-microservices/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-hunter/0.0.1/index.html">猎人-荒野的呼唤</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-hunter/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-logitech/v8.45/index.html">罗技鼠标宏文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-logitech/v8.45/index.html">v8.45</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../docs-milk/0.0.1/index.html">银河奶牛</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs-milk/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs-me/0.0.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../1Preface/readme.html">ES Java API Client</a></li>
    <li><a href="readme.html">聚合</a></li>
    <li><a href="BucketAggregations.html">桶聚合</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.2</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../7.16.0/introduction.html">7.16.0</a>
    <a class="version is-missing" href="../../6.8.0/preface.html">6.8.0</a>
    <a class="version is-current" href="BucketAggregations.html">6.2.2</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/qq253498229/docs-es-java/edit/v6.2/modules/ROOT/pages/7Aggregations/BucketAggregations.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">桶聚合</h1>
<div id="preamble">
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>[整体聚合]</p>
</li>
<li>
<p><a href="#_过滤聚合">过滤聚合</a></p>
</li>
<li>
<p><a href="#_多过滤器聚合">多过滤器聚合</a></p>
</li>
<li>
<p><a href="#_无匹配聚合">无匹配聚合</a></p>
</li>
<li>
<p><a href="#_嵌套聚合">嵌套聚合</a></p>
</li>
<li>
<p><a href="#_反向嵌套聚合">反向嵌套聚合</a></p>
</li>
<li>
<p><a href="#_子对象聚合">子对象聚合</a></p>
</li>
<li>
<p><a href="#_匹配聚合">匹配聚合</a></p>
</li>
<li>
<p><a href="#_重要匹配聚合">重要匹配聚合</a></p>
</li>
<li>
<p><a href="#_范围聚合">范围聚合</a></p>
</li>
<li>
<p><a href="#_日期范围聚合">日期范围聚合</a></p>
</li>
<li>
<p><a href="#_Ip范围聚合">Ip范围聚合</a></p>
</li>
<li>
<p><a href="#_柱状图聚合">柱状图聚合</a></p>
</li>
<li>
<p><a href="#_日期柱状图聚合">日期柱状图聚合</a></p>
</li>
<li>
<p><a href="#_地理距离聚合">地理距离聚合</a></p>
</li>
<li>
<p><a href="#_地理哈希网格聚合">地理哈希网格聚合</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_整体聚合"><a class="anchor" href="#_整体聚合"></a>整体聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-global-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求"><a class="anchor" href="#_准备请求"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .global("agg")
    .subAggregation(AggregationBuilders.terms("genders").field("gender"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应"><a class="anchor" href="#_获取响应"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.global.Global;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Global agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_过滤聚合"><a class="anchor" href="#_过滤聚合"></a>过滤聚合</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_准备请求_2"><a class="anchor" href="#_准备请求_2"></a>准备请求</h3>
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-filter-aggregation.html">查看</a> 文档。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .filter("agg", QueryBuilders.termQuery("gender", "male"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_2"><a class="anchor" href="#_获取响应_2"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.filter.Filter;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Filter agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_多过滤器聚合"><a class="anchor" href="#_多过滤器聚合"></a>多过滤器聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-filters-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_3"><a class="anchor" href="#_准备请求_3"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .filters("agg",
            new FiltersAggregator.KeyedFilter("men", QueryBuilders.termQuery("gender", "male")),
            new FiltersAggregator.KeyedFilter("women", QueryBuilders.termQuery("gender", "female")));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_3"><a class="anchor" href="#_获取响应_3"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.filters.Filters;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Filters agg = sr.getAggregations().get("agg");

// For each entry
for (Filters.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();            // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [men], doc_count [4982]
key [women], doc_count [5018]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_无匹配聚合"><a class="anchor" href="#_无匹配聚合"></a>无匹配聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-missing-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_4"><a class="anchor" href="#_准备请求_4"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders.missing("agg").field("gender");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_4"><a class="anchor" href="#_获取响应_4"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.missing.Missing;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Missing agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_嵌套聚合"><a class="anchor" href="#_嵌套聚合"></a>嵌套聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-nested-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_5"><a class="anchor" href="#_准备请求_5"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .nested("agg", "resellers");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_5"><a class="anchor" href="#_获取响应_5"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_反向嵌套聚合"><a class="anchor" href="#_反向嵌套聚合"></a>反向嵌套聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-reverse-nested-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_6"><a class="anchor" href="#_准备请求_6"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .nested("agg", "resellers")
        .subAggregation(
                AggregationBuilders
                        .terms("name").field("resellers.name")
                        .subAggregation(
                                AggregationBuilders
                                        .reverseNested("reseller_to_product")
                        )
        );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_6"><a class="anchor" href="#_获取响应_6"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;
import org.elasticsearch.search.aggregations.bucket.nested.ReverseNested;
import org.elasticsearch.search.aggregations.bucket.terms.Terms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
Terms name = agg.getAggregations().get("name");
for (Terms.Bucket bucket : name.getBuckets()) {
    ReverseNested resellerToProduct = bucket.getAggregations().get("reseller_to_product");
    resellerToProduct.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_子对象聚合"><a class="anchor" href="#_子对象聚合"></a>子对象聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-children-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_7"><a class="anchor" href="#_准备请求_7"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        //agg是聚合名，reseller是子类型
        .children("agg", "reseller");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_7"><a class="anchor" href="#_获取响应_7"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.join.aggregations.Children;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Children agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_匹配聚合"><a class="anchor" href="#_匹配聚合"></a>匹配聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-terms-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_8"><a class="anchor" href="#_准备请求_8"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_8"><a class="anchor" href="#_获取响应_8"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Terms genders = sr.getAggregations().get("genders");

// For each entry
for (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_排序"><a class="anchor" href="#_排序"></a>排序</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.BucketOrder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>以生序方式按其 <strong>doc_count</strong> 排序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.count(true))</code></pre>
</div>
</div>
<div class="paragraph">
<p>以生序方式按其字母顺序排序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.key(true))</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过指标子聚合排序(按汇总名称标志)：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.aggregation("avg_height", false))
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>按多个条件排序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.compound( // in order of priority:
        BucketOrder.aggregation("avg_height", false), // sort by sub-aggregation first
        BucketOrder.count(true))) // then bucket count as a tie-breaker
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_重要匹配聚合"><a class="anchor" href="#_重要匹配聚合"></a>重要匹配聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-significantterms-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_9"><a class="anchor" href="#_准备请求_9"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .significantTerms("significant_countries")
                .field("address.country");

// Let say you search for men only
SearchResponse sr = client.prepareSearch()
        .setQuery(QueryBuilders.termQuery("gender", "male"))
        .addAggregation(aggregation)
        .get();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_9"><a class="anchor" href="#_获取响应_9"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.significant.SignificantTerms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
SignificantTerms agg = sr.getAggregations().get("significant_countries");

// For each entry
for (SignificantTerms.Bucket entry : agg.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_范围聚合"><a class="anchor" href="#_范围聚合"></a>范围聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-range-aggregation.html">查看</a> 文档。</p>
</div>
<div class="sect2">
<h3 id="_准备请求_10"><a class="anchor" href="#_准备请求_10"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .range("agg")
                .field("height")
                .addUnboundedTo(1.0f)               // from -infinity to 1.0 (excluded)
                .addRange(1.0f, 1.5f)               // from 1.0 to 1.5 (excluded)
                .addUnboundedFrom(1.5f);            // from 1.5 to +infinity</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_10"><a class="anchor" href="#_获取响应_10"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java// sr is here your SearchResponse object hljs" data-lang="java// sr is here your SearchResponse object">       Range agg = sr.getAggregations().get("agg");

       // For each entry
       for (Range.Bucket entry : agg.getBuckets()) {
           String key = entry.getKeyAsString();             // Range as key
           Number from = (Number) entry.getFrom();          // Bucket from
           Number to = (Number) entry.getTo();              // Bucket to
           long docCount = entry.getDocCount();    // Doc count

           logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
       }</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [*-1.0], from [-Infinity], to [1.0], doc_count [9]
key [1.0-1.5], from [1.0], to [1.5], doc_count [21]
key [1.5-*], from [1.5], to [Infinity], doc_count [20]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_日期范围聚合"><a class="anchor" href="#_日期范围聚合"></a>日期范围聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-daterange-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_11"><a class="anchor" href="#_准备请求_11"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateRange("agg")
                .field("dateOfBirth")
                .format("yyyy")
                .addUnboundedTo("1950")    // from -infinity to 1950 (excluded)
                .addRange("1950", "1960")  // from 1950 to 1960 (excluded)
                .addUnboundedFrom("1960"); // from 1960 to +infinity</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_11"><a class="anchor" href="#_获取响应_11"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();                // Date range as key
    DateTime fromAsDate = (DateTime) entry.getFrom();   // Date bucket from as a Date
    DateTime toAsDate = (DateTime) entry.getTo();       // Date bucket to as a Date
    long docCount = entry.getDocCount();                // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsDate, toAsDate, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [*-1950], from [null], to [1950-01-01T00:00:00.000Z], doc_count [8]
key [1950-1960], from [1950-01-01T00:00:00.000Z], to [1960-01-01T00:00:00.000Z], doc_count [5]
key [1960-*], from [1960-01-01T00:00:00.000Z], to [null], doc_count [37]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Ip范围聚合"><a class="anchor" href="#_Ip范围聚合"></a>Ip范围聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-iprange-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_12"><a class="anchor" href="#_准备请求_12"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregatorBuilder&lt;?&gt; aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addUnboundedTo("192.168.1.0")             // from -infinity to 192.168.1.0 (excluded)
                .addRange("192.168.1.0", "192.168.2.0")    // from 192.168.1.0 to 192.168.2.0 (excluded)
                .addUnboundedFrom("192.168.2.0");          // from 192.168.2.0 to +infinity</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，你也可以使用ip掩码作为范围：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregatorBuilder&lt;?&gt; aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addMaskRange("192.168.0.0/32")
                .addMaskRange("192.168.0.0/24")
                .addMaskRange("192.168.0.0/16");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_12"><a class="anchor" href="#_获取响应_12"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();            // Ip range as key
    String fromAsString = entry.getFromAsString();  // Ip bucket from as a String
    String toAsString = entry.getToAsString();      // Ip bucket to as a String
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsString, toAsString, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个请求的返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [*-192.168.1.0], from [null], to [192.168.1.0], doc_count [13]
key [192.168.1.0-192.168.2.0], from [192.168.1.0], to [192.168.2.0], doc_count [14]
key [192.168.2.0-*], from [192.168.2.0], to [null], doc_count [23]</code></pre>
</div>
</div>
<div class="paragraph">
<p>第二个：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [192.168.0.0/32], from [192.168.0.0], to [192.168.0.1], doc_count [0]
key [192.168.0.0/24], from [192.168.0.0], to [192.168.1.0], doc_count [13]
key [192.168.0.0/16], from [192.168.0.0], to [192.169.0.0], doc_count [50]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_柱状图聚合"><a class="anchor" href="#_柱状图聚合"></a>柱状图聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-histogram-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_13"><a class="anchor" href="#_准备请求_13"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .histogram("agg")
                .field("height")
                .interval(1);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_13"><a class="anchor" href="#_获取响应_13"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    Number key = (Number) entry.getKey();   // Key
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], doc_count [{}]", key, docCount);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_排序_2"><a class="anchor" href="#_排序_2"></a>排序</h3>
<div class="paragraph">
<p>支持与 <a href="#_匹配聚合">匹配聚合</a> 相同的排序功能。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_日期柱状图聚合"><a class="anchor" href="#_日期柱状图聚合"></a>日期柱状图聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-datehistogram-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_14"><a class="anchor" href="#_准备请求_14"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .dateHistogramInterval(DateHistogramInterval.YEAR);</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你想设置10天间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .dateHistogramInterval(DateHistogramInterval.days(10));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_14"><a class="anchor" href="#_获取响应_14"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    DateTime key = (DateTime) entry.getKey();    // Key
    String keyAsString = entry.getKeyAsString(); // Key as String
    long docCount = entry.getDocCount();         // Doc count

    logger.info("key [{}], date [{}], doc_count [{}]", keyAsString, key.getYear(), docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个请求的返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [1942-01-01T00:00:00.000Z], date [1942], doc_count [1]
key [1945-01-01T00:00:00.000Z], date [1945], doc_count [1]
key [1946-01-01T00:00:00.000Z], date [1946], doc_count [1]
...
key [2005-01-01T00:00:00.000Z], date [2005], doc_count [1]
key [2007-01-01T00:00:00.000Z], date [2007], doc_count [2]
key [2008-01-01T00:00:00.000Z], date [2008], doc_count [3]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_排序_3"><a class="anchor" href="#_排序_3"></a>排序</h3>
<div class="paragraph">
<p>支持与 <a href="#_匹配聚合">匹配聚合</a> 相同的排序功能。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_地理距离聚合"><a class="anchor" href="#_地理距离聚合"></a>地理距离聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-geodistance-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_15"><a class="anchor" href="#_准备请求_15"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geoDistance("agg", new GeoPoint(48.84237171118314,2.33320027692004))
                .field("address.location")
                .unit(DistanceUnit.KILOMETERS)
                .addUnboundedTo(3.0)
                .addRange(3.0, 10.0)
                .addRange(10.0, 500.0);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_15"><a class="anchor" href="#_获取响应_15"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();    // key as String
    Number from = (Number) entry.getFrom(); // bucket from value
    Number to = (Number) entry.getTo();     // bucket to value
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [*-3.0], from [0.0], to [3.0], doc_count [161]
key [3.0-10.0], from [3.0], to [10.0], doc_count [460]
key [10.0-500.0], from [10.0], to [500.0], doc_count [4925]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_地理哈希网格聚合"><a class="anchor" href="#_地理哈希网格聚合"></a>地理哈希网格聚合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>点击 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-geohashgrid-aggregation.html">查看</a></p>
</div>
<div class="sect2">
<h3 id="_准备请求_16"><a class="anchor" href="#_准备请求_16"></a>准备请求</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geohashGrid("agg")
                .field("address.location")
                .precision(4);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取响应_16"><a class="anchor" href="#_获取响应_16"></a>获取响应</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.elasticsearch.search.aggregations.bucket.geogrid.GeoHashGrid;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// sr is here your SearchResponse object
GeoHashGrid agg = sr.getAggregations().get("agg");

// For each entry
for (GeoHashGrid.Bucket entry : agg.getBuckets()) {
   String keyAsString = entry.getKeyAsString(); // key as String
   GeoPoint key = (GeoPoint) entry.getKey();    // key as geo point
   long docCount = entry.getDocCount();         // Doc count

   logger.info("key [{}], point {}, doc_count [{}]", keyAsString, key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">key [gbqu], point [47.197265625, -1.58203125], doc_count [1282]
key [gbvn], point [50.361328125, -4.04296875], doc_count [1248]
key [u1j0], point [50.712890625, 7.20703125], doc_count [1156]
key [u0j2], point [45.087890625, 7.55859375], doc_count [1138]
...</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
