<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>身份认证 :: docs-me</title>
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">docs-me</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs-greenworks-js" data-version="0.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Greenworks-JS 文档</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Authentication.html">身份认证</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Achievement.html">成就</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cloud.html">Steam 云服务</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="DLC.html">DLC</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Events.html">事件</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Friends.html">好友</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Setting.html">环境设置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Stats.html">统计</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Utils.html">工具方法</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Workshop.html">创意工坊</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Lobby.html">匹配大厅</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Greenworks-JS 文档</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Greenworks-JS 文档</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-pd2/0.0.1/index.html">PD2记录</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-pd2/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-peerjs/0.0.1/index.html">PEER JS</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-peerjs/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-actuator/3.3.3/index.html">Spring Boot Actuator</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-actuator/3.3.3/index.html">3.3.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-spring-boot-admin/0.0.1/index.html">SpringBootAdmin文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-spring-boot-admin/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-steamworks-rs/0.11.0/index.html">Steamworks for Rust</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-steamworks-rs/0.11.0/index.html">0.11.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-tauri/v1/index.html">Tauri API 文档</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-tauri/v1/index.html">v1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-testing-angular/中文/start.html">Testing Angular</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-testing-angular/中文/start.html">中文</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-me/0.0.1/index.html">个人记录</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-me/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-taiwu/0.0.1/index.html">太吾绘卷</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-taiwu/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../docs-palworld/0.0.1/index.html">幻兽帕鲁笔记</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../docs-palworld/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../docs-me/0.0.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Greenworks-JS 文档</a></li>
    <li><a href="Authentication.html">身份认证</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/qq253498229/docs-greenworks-js/edit/master/modules/ROOT/pages/Authentication.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="目录" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">身份认证</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>身份认证API提供了一些工具来认证Steam用户的身份以及判断用户是否拥有应用的所有权。</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: 身份认证API需要一个额外的动态库。 请从Steamworks SDK (<code>&lt;steam_sdk-path&gt;/public/steam/lib/</code> 目录)复制 <code>sdkencryptedappticket.dll</code>/<code>libsdkencryptedappticket.dylib</code>/<code>libsdkencryptedappticket.so</code> 文件到应用文件夹 <code>&lt;greenworks&gt;/lib</code> 中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var greenworks = require('./greenworks');

greenworks.init();

greenworks.getEncryptedAppTicket('test_content', function(ticket) {
    console.log("ticket: " + ticket.toString('hex'));
    // Specify the secret key.
    var key = new Buffer(32);
    // TODO: you must initialize Buffer key with the secret key of your game here,
    // e.g. key = new Buffer([0x0a, ..., 0x0b]).
    assert(key.length == greenworks.EncryptedAppTicketSymmetricKeyLength)
    var decrypted_app_ticket = greenworks.decryptAppTicket(ticket, key);
    if (decrypted_app_ticket) {
        console.log(greenworks.isTicketForApp(decrypted_app_ticket,
            greenworks.getAppId()));
        console.log(greenworks.getTicketAppId(decrypted_app_ticket));
        console.log(greenworks.getTicketSteamId(decrypted_app_ticket));
        console.log(greenworks.getTicketIssueTime(decrypted_app_ticket));
    }
}, function(err) { throw err; });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取身份验证会话ticket"><a class="anchor" href="#_获取身份验证会话ticket"></a>1. 获取身份验证会话ticket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.getAuthSessionTicket(success_callback, [error_callback])</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>success_callback</code> Function(ticket)</p>
<div class="ulist">
<ul>
<li>
<p><code>ticket</code> Object:</p>
<div class="ulist">
<ul>
<li>
<p><code>ticket</code> Buffer: <code>ticket</code> 的值。</p>
</li>
<li>
<p><code>handle</code> Integer: 该ticket返回的 <code>handle</code>。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>error_callback</code> Function(err)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>获取要发送给希望对您进行身份验证的实体的ticket。</p>
</div>
<div class="paragraph">
<p>ticket buffer 可以像 <code>ticket.toString('hex')</code> 这样在 Web API <code>ISteamUserAuth/AuthenticateUserTicket</code> 中被使用，这样就可以从游戏服务器安全的获得授权的Steam ID。 如果票证未被使用，则需要使用 <code>handle</code> 来将ticket作废。</p>
</div>
<div class="paragraph">
<p>注意一旦创建ticket的进程终止了，那么生成出来的ticket就无效了。 所以如果您想要在某些临时进程中创建ticket，请确保这些ticket在身份验证结束前保持有效！</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_取消身份ticket"><a class="anchor" href="#_取消身份ticket"></a>2. 取消身份ticket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.cancelAuthTicket(ticket_handle)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ticket_handle</code> Integer: 该ticket返回的 <code>handle</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>将请求的session ticket 作废。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取加密应用ticket"><a class="anchor" href="#_获取加密应用ticket"></a>3. 获取加密应用ticket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.getEncryptedAppTicket(user_data, success_callback, [error_callback])</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user_data</code> String: 将要加密到ticket中的任意值。将会以utf-8编码存储在ticket中。</p>
</li>
<li>
<p><code>success_callback</code> Function(encrypted_ticket)</p>
<div class="ulist">
<ul>
<li>
<p><code>encrypted_ticket</code> Buffer: 加密过的ticket。</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>error_callback</code> Function(err)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>加密ticket可以用来从客户端获取认证的Steam Id，而无需向Steam的API服务器发送网络请求。 这些ticket可以通过加密应用的ticket秘钥来进行解密。 在解密之后，可以通过Steamworks SDK中提供的加密应用ticket库，从ticket中查看用户的Steam ID、App ID、以及 VAC ban状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_解密应用ticket"><a class="anchor" href="#_解密应用ticket"></a>4. 解密应用ticket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.decryptAppTicket(encrypted_ticket, decryption_key)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>encrypted_ticket</code> Buffer: 加密过的ticket。</p>
</li>
<li>
<p><code>decryption_key</code> Buffer: 用于解密的秘钥。其长度应该是 <code>greenworks.EncryptedAppTicketSymmetricKeyLength</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用解密key可以堆加密过的应用ticket进行解密。 如果解密成功则会返回一个 <code>Buffer</code>；否则会返回 <code>Null</code>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_是该应用的ticket"><a class="anchor" href="#_是该应用的ticket"></a>5. 是该应用的ticket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.isTicketForApp(decrypted_ticket, app_id)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>decrypted_ticket</code> Buffer: 解密过的ticket。</p>
</li>
<li>
<p><code>app_id</code> Integer: 这个app的id。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>返回一个 <code>Boolean</code> 值，表示解密ticket是否适用于该应用。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取ticket的发布时间"><a class="anchor" href="#_获取ticket的发布时间"></a>6. 获取ticket的发布时间</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.getTicketIssueTime(decrypted_ticket)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>decrypted_ticket</code> Buffer: 解密过的ticket。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>返回一个 <code>Integer</code>，表示该ticket的发布时间。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取ticket对应的steamid"><a class="anchor" href="#_获取ticket对应的steamid"></a>7. 获取ticket对应的SteamId</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.getTicketSteamId(decrypted_ticket)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>decrypted_ticket</code> Buffer: 解密过的ticket。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>返回一个 <a href="Friends.html#SteamID" class="xref page">SteamID</a> 对象，表示该ticket的steam id。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取ticket的app_id"><a class="anchor" href="#_获取ticket的app_id"></a>8. 获取ticket的app id</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>greenworks.getTicketAppId(decrypted_ticket)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>decrypted_ticket</code> Buffer: 解密过的ticket。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>返回一个 <code>Integer</code> ，表示该ticket的app id。</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
